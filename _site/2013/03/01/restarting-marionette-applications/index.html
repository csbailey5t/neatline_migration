<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Restarting Marionette applications</title>
<script src="https://cdn.levelaccess.net/accessjs/YW1wX3V2YTExMDA/access.js" type="text/javascript"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Neatline allows scholars, students, and curators to tell stories with maps and timelines.">
<link rel="canonical" href="http://localhost:4000/2013/03/01/restarting-marionette-applications/">

<link rel="icon" type="image/png" href="http://localhost:4000/assets/images/favicon.png" >
<link rel="apple-touch-icon" type="image/png" href="http://localhost:4000/assets/images/apple-touch-icon.png">

<!-- Style sheets -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<link href="//fonts.googleapis.com/css?family=Crimson+Text:400,600,400italic,600italic|Cabin:400,600,400italic" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oswald:400,500,700&display=swap" rel="stylesheet"><link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">

<!-- Modernizr and Friends -->
<script src="http://localhost:4000/assets/js/modernizr.min.js"></script>
<script>
    Modernizr.load([
        {
            test: Modernizr.mq(),
            nope: [
                'http://localhost:4000/assets/js/respond.min.js',
                'http://localhost:4000/assets/js/selectivizr.min.js'
            ]
        }
    ]);
</script>




  </head>
  
  <body>
    <a href="#main" id="skipnav">Skip to main content</a>
    <header role="banner">
    <nav class="navbar-light bg-light">
      <div class="topnav">
            <a href="http://localhost:4000" title="Neatline"> 
              <img class="logo" src="http://localhost:4000/assets/images/neatline-logo-rgb.png" alt="Neatline"/>
            </a>  
          <ul class="nav navigation">
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/about/">What is Neatline?</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/showcase/">Showcase</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/plugins/">Add-Ons</a>
            </li>
            <!-- <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/themes/">Themes</a>
            </li> -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                User Guides
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                  <!-- <a class="dropdown-item" href="http://localhost:4000/use-cases/">Use Cases</a> -->
                  <!-- <a class="dropdown-item" href="http://localhost:4000/tutorials/">Tutorials</a> -->
                  <a class="dropdown-item" href="http://localhost:4000/docs/">Neatline for Omeka Classic</a>
                  <a class="dropdown-item" href="http://localhost:4000/docs-s/">Neatline for Omeka S</a>
                </div>
            </li>  
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/blog/">News</a>
            </li>
            <li class="nav-item">
              <a href="http://localhost:4000/publications/" class="nav-link">Publications</a>
            </li>
            <li class="nav-item">
              <a href="http://localhost:4000/credits/" class="nav-link">Credits</a>
            </li>
            <li class="nav-item">
              <a href="http://localhost:4000/search/" class="btn btn-outline" title= "Search neatline.org" aria-label="Search neatline.org"><i class="fas fa-search"></i></a>
            </li>
          </ul>
        </div>
      </nav>
    
</header>

      <div class="wrapper">
        <main id="main" class="main-content container" role="main" >
          <div class="container">
  <header class="post-header">
    <h1>Restarting Marionette applications</h1>
    <p class="meta">Mar 1, 2013 • dm4fn</p>
  </header>

  <article class="post-content">
  <p><span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc&amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator&amp;rft.type=&amp;rft.format=text&amp;rft.title=Restarting+Marionette+applications&amp;rft.source=Scholars%26%23039%3B+Lab&amp;rft.date=2013-03-01&amp;rft.identifier=http%3A%2F%2Fwww.scholarslab.org%2Fresearch-and-development%2Frestarting-marionette-applications%2F&amp;rft.language=English&amp;rft.subject=Research+and+Development&amp;rft.aulast=McClure&amp;rft.aufirst=David"></span> 
<em>[Cross-posted from <a href="http://dclure.org/logs/restarting-marionette-applications/">dclure.org</a>]</em></p>

<p>Over the course of the last couple months, I’ve been using Derick Bailey’s superb <a href="https://github.com/marionettejs/backbone.marionette">Marionette</a> framework for Backbone.js to build the new version of Neatline. Marionette sits somewhere in the hazy zone between a library and a framework – it’s really a collection of architectural components for large front-end applications that can be composed in lots of different ways. I use Marionette mainly for the core set of message-passing utilities, which make it easy to define interactions among different parts of big applications – pub-sub event channels, command execution, request-response patterns, etc. I’ve come to completely rely on these structures, and can’t really imagine writing non-trivial applications without them anymore.</p>

<p>The only big kink I’ve encountered is in the Jasmine suite. Since almost all of the integration-level test cases mutate the state of the application (trigger routes, open/close views, etc.), I needed to completely burn down the app and re-start it from scratch at the beginning of each test to ensure a clean slate. The top-level Marionette <code class="highlighter-rouge">Application</code> has a <code class="highlighter-rouge">start</code> method that walks down the tree of modules and runs the initializers. As it exists now, though, <code class="highlighter-rouge">start</code> can only be called once during the lifecycle of the application, and does nothing if it’s called again later on.</p>

<p>I was getting around this by defining independently-callable <code class="highlighter-rouge">init</code> methods for all of my modules and wiring them up to the regular Marionette start-up system:</p>

<p>But then manually calling all of the init methods in my Jasmine start-up routine to force-restart the application:</p>

<p>This is icky – I have to exactly recreate a specific start-up order that’s automatically enforced in the application itself by <code class="highlighter-rouge">before:</code> and <code class="highlighter-rouge">after:</code> initialization events. And it introduces lots of opportunities for false-negatives – if you add a module, and forget to explicitly start it in the test suite, everything falls apart.</p>

<p>Really, I wanted to just re-call <code class="highlighter-rouge">Neatline.start()</code> before every test. I realized tonight, though, that the application object can be tricked into restarting itself by (a) stopping all of the modules and (b) resetting the top-level <code class="highlighter-rouge">Callbacks</code> on the application:</p>

<p>Much cleaner. Assuming all state-bearing components are instantiated in the initializers, this has the desired effect of completely rebooting the application.</p>

<p>I’d imagine this is a pretty common issue – is there any philosophical reason for the prohibition against re-calling <code class="highlighter-rouge">Application.start()</code> more than once?</p>


  </article>

  <div class="PageNavigation">
    
      <a class="prev" href="/2013/02/26/neatline-and-omeka-2-0-2/">&laquo; Neatline and Omeka 2.0</a>
    
    
      <a class="next" href="/2013/05/13/announcing-neatline-2-0-alpha1-2/">Announcing Neatline 2.0-alpha1! &raquo;</a>
    
  </div>
</div>
        </main>
      </div>

    <footer role="contentinfo">
      
 <div class="container">
    <div class="row ">
      <div class="col-md-6">
        <p class="fs-2">
            Neatline is a project of the <a href="http://www.scholarslab.org/">Scholars' Lab</a> at the University of Virginia Library. It has benefited from the generous support of the <a href="http://lib.virginia.edu">UVa Library</a>, the <a href="http://neh.gov">National Endowment for the Humanities</a>, the <a href="http://imls.gov">Institute of Museum and Library Services</a>, and the <a href="http://loc.gov">Library of Congress</a>.
        </p>
      </div>
      <div class="col">
        <ul class="fs-2">
          <li><a href="https://forum.omeka.org/">Contact Us</a></li>
          <li><a rel="license" class="license" href="http://creativecommons.org/licenses/by/3.0/">CC-BY 3.0</a></li>
        </ul>
      </div>
      <div class="col">
          <a href="http://scholarslab.org" id="slab-link" title="Scholars Lab logo link" aria-label="Scholars Lab logo link">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          viewBox="0 0 438.9 87.8" style="enable-background:new 0 0 438.9 87.8;" xml:space="preserve">
         <path d="M29.3,63.1c0,12.3-7.7,20.5-23.1,24.6l-5.1-11c4.8-1.4,8.2-2.8,10.4-4.3c3.4-2.4,5-5.5,5-9.3c0-2.9-1.4-6.5-4.3-10.7
           C9.6,48.5,7,44.6,4.4,40.7c-2.9-5-4.3-9.9-4.3-14.7c0-6.2,2.5-11.7,7.6-16.7C12.4,4.6,18,1.5,24.7,0l3.8,11.8
           C18.1,14.6,13,19.3,13,25.9c0,3.5,1.4,7.5,4.3,11.8c2.6,3.8,5.2,7.6,7.8,11.4C27.9,54,29.3,58.6,29.3,63.1L29.3,63.1z"/>
         <path d="M61.2,85.1c-3.6,1.1-6.2,1.7-7.8,1.7c-7.2,0-12.8-3.4-16.8-10.2c-4-6.8-6-16.4-6-28.7c0-12.3,2-21.9,6-28.7
           c4-6.8,9.6-10.2,16.8-10.2c1.6,0,4.2,0.6,7.8,1.7L58,19.7c-1.6-0.6-3.1-0.8-4.5-0.8c-7.6,0-11.4,9.7-11.4,29c0,19.3,3.8,29,11.4,29
           c1.5,0,3-0.3,4.5-0.8L61.2,85.1z"/>
         <path d="M100.2,85.9H88.7V55.3H77.6v30.7H66.1V55.3h-3.9v-9.9h3.9V9.8h11.5v35.6h11.1V9.8h11.5C100.2,9.8,100.2,85.9,100.2,85.9z"
           />
         <path d="M140.4,47.8c0,25.9-5.8,38.9-17.5,38.9c-11.7,0-17.6-13-17.6-38.9c0-12.6,1.1-21.8,3.3-27.8c2.7-7.4,7.5-11.1,14.3-11.1
           c6.6,0,11.3,3.7,14.1,11.1C139.3,26.1,140.4,35.4,140.4,47.8L140.4,47.8z M129,47.8c0-19.3-2.1-29-6.2-29c-4.1,0-6.2,9.7-6.2,29
           c0,19.3,2,29,6.2,29C127,76.8,129,67.2,129,47.8L129,47.8z"/>
         <path d="M169.4,85.9h-23.1V9.8h11.5V76h11.6V85.9z"/>
         <path d="M213.2,85.9h-11.9l-1.3-6.8H189l-1.3,6.8h-11.9l1.5-6.8h-4.5l2.3-9.9h4.4l13.5-61.1h3.3L213.2,85.9z M198,69.2l-3.5-18.9
           l-3.7,18.9H198z"/>
         <path d="M248.5,83.7l-11.2,3.4l-10.6-31.2v30h-11.5V9.8h11.5c6.7,0,11.8,2.5,15.3,7.4c3.2,4.5,4.7,10.5,4.7,18.1
           c0,8.1-2.5,14.7-7.6,20L248.5,83.7z M234.8,35.3c0-10.4-2.7-15.6-8.1-15.6v32.6c2.4,0,4.4-1.6,5.9-4.7
           C234.1,44.4,234.8,40.3,234.8,35.3L234.8,35.3z"/>
         <path d="M276,64.9c0,10.8-6.9,18.1-20.6,21.8l-4.5-9.7c4.2-1.2,7.3-2.5,9.2-3.9c3-2,4.5-4.8,4.5-8.2c0-2.6-1.3-5.8-3.8-9.5
           c-2.3-3.5-4.7-6.9-7-10.4c-2.5-4.5-3.8-8.8-3.8-13.1c0-5.5,2.2-10.5,6.7-14.9c4.2-4.1,9.2-6.9,15.1-8.2l3.4,10.5
           c-9.2,2.5-13.7,6.7-13.7,12.5c0,3.1,1.2,6.6,3.7,10.5c2.3,3.3,4.7,6.7,7,10.1C274.8,56.8,276,60.9,276,64.9L276,64.9z"/>
         <path d="M298.9,3.7l-12.2,29.8l-6.8-2l6.8-31.4L298.9,3.7z"/>
         <path d="M357.1,85.9h-26V0.5h12.8v74.3h13.2L357.1,85.9L357.1,85.9z"/>
         <path d="M401.6,85.9h-11.9l-1.3-6.8h-10.9l-1.3,6.8h-11.9l1.5-6.8h-4.5l2.3-9.9h4.4l13.5-61.1h3.3L401.6,85.9z M386.4,69.2
           l-3.5-18.9l-3.7,18.9H386.4z"/>
         <path d="M438.9,66.1c0,6.3-1.7,11.1-5,14.6c-3.5,3.5-8.6,5.3-15.3,5.3h-11.5V9.8h11.5c6.6,0,11.7,2,15.3,6c3.3,3.8,5,9.2,5,16
           c0,8.6-2.2,14.4-6.7,17.4C436.6,52.9,438.9,58.6,438.9,66.1L438.9,66.1z M427.8,31.8c0-8-3.1-12.1-9.2-12.1v25.6c3.2,0,5.5-1,7-3.1
           C427,40.2,427.8,36.7,427.8,31.8L427.8,31.8z M427.8,66.1c0-7.2-3.1-10.8-9.2-10.8V76C424.7,76,427.8,72.7,427.8,66.1L427.8,66.1z"
           />
       </svg>
      </a>
      </div>
    </div>
  </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="http://localhost:4000/assets/js/bootstrap/bootstrap.bundle.min.js"></script>
  </body>
</html>
