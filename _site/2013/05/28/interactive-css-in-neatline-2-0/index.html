<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Interactive CSS in Neatline 2.0</title>
<script src="https://cdn.levelaccess.net/accessjs/YW1wX3V2YTExMDA/access.js" type="text/javascript"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="Neatline allows scholars, students, and curators to tell stories with maps and timelines.">
<link rel="canonical" href="http://localhost:4000/2013/05/28/interactive-css-in-neatline-2-0/">

<link rel="icon" type="image/png" href="http://localhost:4000/assets/images/favicon.png" >
<link rel="apple-touch-icon" type="image/png" href="http://localhost:4000/assets/images/apple-touch-icon.png">

<!-- Style sheets -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

<!-- <link href="//fonts.googleapis.com/css?family=Crimson+Text:400,600,400italic,600italic|Cabin:400,600,400italic" rel="stylesheet" type="text/css" />
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->

<!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/carousel.css"> -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
<link rel="stylesheet" href="http://localhost:4000/assets/css/docs.css">

<!-- Feeds and Pingbacks -->
<link rel="alternate" type="application/rss+xml" title="Neatline" href=" http://localhost:4000/feed.xml">

<!-- Modernizr and Friends -->
<script src="http://localhost:4000/assets/js/modernizr.min.js"></script>
<script>
    Modernizr.load([
        {
            test: Modernizr.mq(),
            nope: [
                'http://localhost:4000/assets/js/respond.min.js',
                'http://localhost:4000/assets/js/selectivizr.min.js'
            ]
        }
    ]);
    (function() {
        var cx = '009145345920904867543:1jiuohixchs';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
    })();
</script>




  </head>
  
  <body>

    <header role="banner">
    <nav class="navbar-light bg-light">
      <div class="topnav">
            <a href="/http://localhost:4000" title="Neatline">
              <img class="logo" src="http://localhost:4000/assets/images/neatline-logo-rgb.png" alt="Neatline"/>
            </a>  
          <ul class="nav navigation">
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/about/">About</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Documentation
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="http://localhost:4000/docs/">Neatline for Omeka Classic</a>
                  <a class="dropdown-item" href="#">Neatline for Omeka S</a>
                </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href=http://localhost:4000/demos/>Demos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/plugins/">Plugins</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://localhost:4000/news/">Blog</a>
            </li>
            <li class="nav-item">
              <a href="http://localhost:4000/publications/" class="nav-link">Publications</a>
            </li>
            <li class="nav-item">
              <a href="http://localhost:4000/credits/" class="nav-link">Credits</a>
            </li>
          </ul>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample01" aria-controls="navbarsExample01" aria-expanded="false" aria-label="Toggle Search">
              <i class="fas fa-search"></i>
          </button>
          <div class="collapse navbar-collapse" id="navbarsExample01">
            <div id="custom_search">
                <gcse:searchbox-only resultsUrl="/results/"></gcse:searchbox-only>
            </div>
          </div>
        </div>
      </nav>
    
</header>

    <div class="wrapper">
    <main id="main" class="main-content container" role="main" >
      <div class="container px-lg-5">

  <header class="post-header">
    <h1>Interactive CSS in Neatline 2.0</h1>
    <p class="meta">May 28, 2013 • clured</p>
  </header>

  <article class="post-content">
  <p><em>[Cross-posted with <a href="http://dclure.org/uncategorized/interactive-css-in-neatline-2-0/">dclure.org</a>]</em></p>

<p>Neatline 2.0 makes it possible to work with really large collections of records – as many as about <a href="http://dclure.org/logs/neatline-one-million-records/">1,000,000 in a single exhibit</a>. This level of scalability opens up the door to a whole range of projects that would have been impossible with the first version of Neatline, but it also introduces some really interesting content management challenges. If the map can <em>display</em> millions of records, it also needs utilities to effectively <em>manage</em> content at that scale.</p>

<p>This often involves a shift from working with individual records to working with groups of records. When there are a million records on the map, it’s pretty unlikely that you’ll want to change the color of just one of them. More likely, that record will exist as part of a large grouping of related records (eg, “democratic precincts,” or “photographs from 1945″), all of which should share a certain set of attributes. There needs to be a way to slice and dice records into overlapping clusters of related records, and then apply bulk updates to the individual clusters.</p>

<p>Really, this is a familiar problem – it’s structurally identical to the task of styling web pages with CSS, which makes it possible to address groupings of elements with “selectors” and apply key-value styling rules to the groups. Inspired by projects like Mike Migurski’s <a href="https://github.com/mapnik/Cascadenik"><strong>Cascadenick</strong></a>, Neatline 2.0 makes it possible to use a Neatline-inflected dialect of CSS to update groups of records linked together with “tags,” which can be applied in any combination to the individual records.</p>

<p><strong>Neatline Stylesheet Basics</strong></p>

<p>Let’s take a look at how this works in practice. Imagine you’re plotting results from the last four presidential elections. You load in a big collection of 800,000 records (200,000 precincts for each of the four elections), each representing an individual polling place with a point on the map. Each point is scaled to represent the number of ballots cast at that location, and shared red or blue according to which party won more votes. In this case, there are really seven different nested and overlapping taxonomies in the data. All of the records are <code class="highlighter-rouge">precincts</code>, but each falls into one of the our election seasons – <code class="highlighter-rouge">2000</code>, <code class="highlighter-rouge">2004</code>, <code class="highlighter-rouge">2008</code>, or <code class="highlighter-rouge">2012</code>. And each precinct went either <code class="highlighter-rouge">democrat</code> or <code class="highlighter-rouge">republican</code>, regardless of which election cycle it belongs to. Each record can be tagged with some combination of these tags:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/tags-input.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/tags-input.jpg" alt="tags-input" width="396" height="331" class="alignnone size-full wp-image-8293" /></a></p>

<p>Each of the groupings needs to share a specific set of attributes – and also <em>not</em> share some attributes that need to be assigned separate values on individual records. For example, all of the precincts – regardless of date or party – should share the same basic <code class="highlighter-rouge">fill-opacity</code> and <code class="highlighter-rouge">stroke-width</code> styles. All records in each of the groupings for the four election seasons need to share the same <code class="highlighter-rouge">after-date</code> and <code class="highlighter-rouge">before-date</code> visibility settings so that the records phase in and out of visibility in unison. And all republican and democratic records should share the same shares of red and blue. Meanwhile, none of the groupings should define a standard point-radius style, which is used on a per-record basis to encode the number of ballots cast at that location.</p>

<p>Neatline-inflected CSS makes it easy to model these relationships. To start, I’ll define some basic styles for the top-level <code class="highlighter-rouge">precinct</code> tag, which is applied to all the records in the exhibit:</p>

<p>Now, when I click “Save,” Neatline instantaneously updates the <code class="highlighter-rouge">stroke-width</code> and <code class="highlighter-rouge">fill-opacity</code> styles on all records tagged with <code class="highlighter-rouge">precinct</code>:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/precinct-styles.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/precinct-styles-1024x640.jpg" alt="precinct-styles" width="1024" height="640" class="alignnone size-large wp-image-8294" /></a></p>

<p>Next, I’ll set the <code class="highlighter-rouge">before-date</code> and <code class="highlighter-rouge">after-date</code> properties for each of the for election season tags, which ensure that the four batches of records phase in and out of visibility in unison as the timeline is scrolled back and forth:</p>

<p>Now, when I open up any individual record, the <code class="highlighter-rouge">before-date</code> and <code class="highlighter-rouge">after-date</code> fields will be updated with new values depending on which election the record belongs to:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/dates-fieldset.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/dates-fieldset.jpg" alt="dates-fieldset" width="304" height="353" class="alignnone size-full wp-image-8295" /></a></p>

<p>Last, I’ll define the coloring rules for the two political parties. First, the Democrats:</p>

<p>Click “Save,” and all democratic precincts update with the new color:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/democrat-styles.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/democrat-styles-1024x640.jpg" alt="democrat-styles" width="1024" height="640" class="alignnone size-large wp-image-8296" /></a></p>

<p><strong>Auto-updating stylesheet values</strong></p>

<p>So far, we’ve just been entering hard-coded values into the stylesheet. This often makes sense for properties that have inherently semantic values (eg, dates). For other attributes, though (namely colors), it’s much harder to reason in the abstract about what value you want. For example, I know that I want the republican precincts to be “red,” but I don’t know off-hand that <code class="highlighter-rouge">#ff0000</code> is the specific hexadecimal value that I want to use. It makes more sense to open up the edit form for an individual record and use the color pickers for the “Fill Color” field to find a color that looks good.</p>

<p>And even for styles that can be reasoned about in the abstract, it’s often easier and more intuitive to use the auto-previewing functionality on one of the record forms to tinker around with different values. Once you’ve decided on a new setting, though, it’s annoying to have to manually propagate the value back into the stylesheets so that all of the record’s siblings stay in sync – you’d have to copy the value, close the form, open up the stylesheet, find the right rule, and paste in the new value. To avoid this, Neatline also automatically updates the <em>stylesheet</em> when individual record values are changed, and immediately pushes out the new value to all of the record’s siblings.</p>

<p>Let’s go back to the election results. For the republican precincts, instead of pasting in a specific hex value for the <code class="highlighter-rouge">fill-color</code> style, we’ll just “register” <code class="highlighter-rouge">fill-color</code> as being one of the properties controlled by the <code class="highlighter-rouge">republican</code> tag by listing the style and assigning it a value of <code class="highlighter-rouge">auto</code>:</p>

<p>When I click “Save,” nothing happens, since a value isn’t defined. Now, though, I can just open up any of the individual <code class="highlighter-rouge">republican</code> records, choose a shade of red, and save the record. Since we activated the fill-color style for the republican tag, Neatline automatically updates all of the other <code class="highlighter-rouge">republican</code> records <em>just as if we had set the value directly on the stylesheet</em>:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/republican-record.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/republican-record-1024x640.jpg" alt="republican-record" width="1024" height="640" class="alignnone size-large wp-image-8297" /></a></p>

<p>And now, when I go back to the stylesheet, the <code class="highlighter-rouge">fill-color</code> rule under <code class="highlighter-rouge">republican</code> is automatically updated with the value that we just set in the record form:</p>

<p><a href="http://www.scholarslab.org/wp-content/uploads/2013/05/updated-stylesheet.jpg"><img src="http://www.scholarslab.org/wp-content/uploads/2013/05/updated-stylesheet.jpg" alt="updated-stylesheet" width="304" height="593" class="alignnone size-full wp-image-8298" /></a></p>

<p>This also works for styles that already have concrete values. For example, say I change my mind and want to tweak the shade of blue used for democratic precincts. I can just open up any of the individual <code class="highlighter-rouge">democrat</code>-tagged records, pick a new value with the color picker, and save the record. Again, Neatline automatically replaces the old value on the stylesheet and propagates the change to all of the other democratic precincts.</p>


  </article>

</div>
    </main>
    </div>

    <footer role="contentinfo">
      
<ul class="navigation">
    <li class="list-group-item">
        Neatline is a project of the <a href="http://www.scholarslab.org/">Scholars' Lab</a> at the University of Virginia Library. It has benefited from the generous support of the <a href="http://lib.virginia.edu">UVa Library</a>, the <a href="http://neh.gov">National Endowment for the Humanities</a>, the <a href="http://imls.gov">Institute of Museum and Library Services</a>, and the <a href="http://loc.gov">Library of Congress</a>.
    </li>
    <li class="list-group-item"><a rel="license" class="license" href="http://creativecommons.org/licenses/by/3.0/">CC-BY 3.0</a></li>
    <li class="list-group-item"><a href="https://forum.omeka.org/">Contact Us</a></li>
    <li class="list-group-item">
        <a href="http://scholarslab.org" class="align-self-center ml-3" id="slab-link">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0" y="0" width="438.94" height="87.75" viewBox="0 0 438.94 87.75" enable-background="new 0 0 438.938 87.75" xml:space="preserve">
          <path d="M29.33 63.06c0 12.25-7.7 20.45-23.11 24.62l-5.13-11c4.75-1.37 8.21-2.8 10.36-4.29 3.36-2.37 5.04-5.47 5.04-9.33 0-2.92-1.43-6.49-4.28-10.72 -2.6-3.85-5.2-7.74-7.8-11.65 -2.85-5.03-4.28-9.95-4.28-14.73 0-6.15 2.54-11.71 7.61-16.69 4.63-4.66 10.27-7.74 16.92-9.23l3.8 11.8c-10.33 2.8-15.49 7.49-15.49 14.08 0 3.5 1.4 7.5 4.3 11.84 2.6 3.8 5.2 7.6 7.8 11.4C27.91 54 29.3 58.6 29.3 63.06z"/>
          <path d="M61.16 85.1c-3.6 1.11-6.19 1.67-7.77 1.67 -7.2 0-12.8-3.4-16.81-10.22 -4.01-6.81-6.02-16.38-6.02-28.7 0-12.32 2.01-21.89 6.02-28.7 4.01-6.81 9.61-10.22 16.81-10.22 1.58 0 4.2 0.6 7.8 1.67l-3.22 9.1c-1.58-0.56-3.1-0.84-4.55-0.84 -7.58 0-11.37 9.66-11.37 29 0 19.3 3.8 29 11.4 28.98 1.45 0 2.97-0.28 4.55-0.84L61.16 85.1z"/>
          <path d="M100.15 85.93h-11.46V55.28H77.61v30.65H66.15V55.28h-3.88v-9.94h3.88V9.76h11.46v35.58h11.08V9.76h11.46V85.93z"/>
          <path d="M140.41 47.85c0 25.95-5.84 38.92-17.52 38.92 -11.74 0-17.62-12.97-17.62-38.92 0-12.57 1.1-21.83 3.32-27.77 2.71-7.43 7.49-11.15 14.3-11.15 6.57 0 11.3 3.7 14.1 11.1C139.27 26.1 140.4 35.4 140.4 47.85zM129.05 47.85c0-19.32-2.05-28.98-6.16-28.98 -4.1 0-6.15 9.66-6.15 28.98 0 19.3 2 29 6.2 28.98C126.99 76.8 129 67.2 129 47.85z"/>
          <path d="M169.45 85.93h-23.11V9.76h11.46v66.23h11.65V85.93z"/>
          <path d="M213.17 85.93h-11.94l-1.32-6.78h-10.89l-1.32 6.78h-11.94l1.52-6.78h-4.55l2.27-9.94h4.36l13.45-61.12h3.32L213.17 85.93zM198.02 69.21l-3.51-18.86 -3.69 18.86H198.02z"/>
          <path d="M248.45 83.7l-11.18 3.44 -10.61-31.21v30h-11.46V9.76h11.46c6.69 0 11.8 2.5 15.3 7.4 3.16 4.5 4.7 10.5 4.7 18.13 0 8.06-2.53 14.73-7.58 20L248.45 83.7zM234.81 35.3c0-10.4-2.72-15.6-8.15-15.6v32.6c2.4 0 4.36-1.58 5.87-4.74C234.05 44.4 234.8 40.3 234.8 35.3z"/>
          <path d="M276.04 64.94c0 10.84-6.85 18.11-20.56 21.83l-4.55-9.75c4.23-1.24 7.29-2.54 9.19-3.9 3.03-2.04 4.55-4.77 4.55-8.18 0-2.6-1.26-5.76-3.79-9.47 -2.34-3.47-4.67-6.93-7.01-10.4 -2.52-4.46-3.79-8.82-3.79-13.1 0-5.51 2.24-10.46 6.73-14.86 4.17-4.15 9.19-6.87 15.06-8.17l3.41 10.5c-9.16 2.54-13.73 6.72-13.73 12.54 0 3.1 1.2 6.6 3.7 10.5 2.33 3.3 4.7 6.7 7 10.1C274.77 56.8 276 60.9 276 64.94z"/>
          <path d="M298.87 3.7l-12.22 29.82 -6.82-2.04 6.82-31.4L298.87 3.7z"/>
          <path d="M357.1 85.93H331.15V0.47h12.79v74.31h13.17V85.93z"/>
          <path d="M401.6 85.93h-11.93l-1.33-6.78h-10.89l-1.33 6.78h-11.93l1.52-6.78h-4.55l2.27-9.94h4.36l13.45-61.12h3.31L401.6 85.93zM386.44 69.21l-3.5-18.86 -3.69 18.86H386.44z"/>
          <path d="M438.87 66.05c0 6.26-1.67 11.12-5.02 14.59 -3.54 3.53-8.62 5.29-15.25 5.29h-11.46V9.76H418.6c6.63 0 11.7 2 15.3 6.04 3.35 3.8 5 9.2 5 15.98 0 8.61-2.24 14.4-6.73 17.4C436.63 52.9 438.9 58.6 438.9 66.05zM427.79 31.78c0-8.05-3.06-12.07-9.19-12.07v25.64c3.15 0 5.48-1.04 6.96-3.11C427.04 40.2 427.8 36.7 427.8 31.78zM427.79 66.1c0-7.18-3.06-10.77-9.19-10.77v20.71C424.72 76 427.8 72.7 427.8 66.05z"/>
          </svg>
        </a>
    </li>
  </ul>

    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  
  </body>
</html>
